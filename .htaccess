# --- Angular SPA + PHP (sin bucles) ---
Options -MultiViews

<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /

  # 0) Sirve la home sin inventar redirecciones
  RewriteRule ^$ index.html [L]

  # 0bis) No tocar explícitamente index.html ni share.php (evita bucles)
  RewriteRule ^index\.html$ - [L]
  RewriteRule ^share\.php$ - [L]

  # A) Compat: /share/{type}/{id} -> share.php (añade aquí tus tipos)
  RewriteRule ^share/(events|books|movies|recipes|macroevents|piteras|podcasts)/([0-9]+)/?$ share.php?type=$1&id=$2 [L,QSA]

  # B) BOTS de previsualización (GET/HEAD) -> share.php
  RewriteCond %{REQUEST_METHOD} ^(GET|HEAD)$
  RewriteCond %{HTTP_USER_AGENT} (facebookexternalhit|Facebot|WhatsApp|Twitterbot|Slackbot|TelegramBot|Discordbot|LinkedInBot|Pinterest|SkypeUriPreview) [NC]
  RewriteRule ^(events|books|movies|recipes|macroevents|piteras|podcasts)/([0-9]+)(?:/.*)?$ share.php?type=$1&id=$2 [L,QSA]

  # 1) Deja pasar archivos reales y rutas estáticas (ajusta si usas otras)
  RewriteCond %{REQUEST_FILENAME} -f [OR]
  RewriteCond %{REQUEST_URI} ^/(assets|backend|uploads|config|api)(/|$)
  RewriteRule ^ - [L]

  # 2) No tocar peticiones directas a PHP
  RewriteRule ^(.+\.php)$ - [L]

  # 3) SPA para humanos en secciones conocidas (interno, sin redirect)
  RewriteCond %{REQUEST_METHOD} ^(GET|HEAD)$
  RewriteCond %{HTTP_USER_AGENT} !(facebookexternalhit|Facebot|WhatsApp|Twitterbot|Slackbot|TelegramBot|Discordbot|LinkedInBot|Pinterest|SkypeUriPreview) [NC]
  RewriteRule ^(events|books|movies|recipes|macroevents|piteras|podcasts)(/.*)?$ index.html [L]

  # 4) Fallback general -> index.html (interno, sin redirect)
  RewriteRule . index.html [L]
</IfModule>
