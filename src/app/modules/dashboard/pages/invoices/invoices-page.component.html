<!-- Zona sticky -->
<app-sticky-zone [height]="176">
  <app-dashboard-header
    [icon]="'uil uil-calculator'"
    [title]="'Contabilidad'"
    [number]="list.countSig()"
    [type]="'Movimientos'"
  />
  <div class="flex flex-1 flex-col justify-start">
    <app-filters
      [filters]="filters"
      [(selected)]="selectedFilter"
      (filterClicked)="filterSelected($event)"
    />
  </div>
</app-sticky-zone>

<!-- Zona principal -->
<div class="flex flex-col px-8 items-center">
  @if (invoicesFacade.isLoadingList$ | async) {
  <div class="flex justify-center items-center py-16">
    <app-spinner-loading />
  </div>
  } @else { @if (hasInvoicesForYearSig()) {
  <mat-tab-group
    (selectedTabChange)="tabActive($event)"
    [selectedIndex]="selectedIndex"
  >
    <mat-tab label="Contabilidad completa">
      <div class="flex flex-col gap-y-8 py-8">
        <app-page-toolbar
          [addText]="'Añadir movimiento'"
          [columns]="headerListInvoices"
          [visibility]="col.columnVisSig"
          (add)="addNewInvoiceModal()"
          (search)="applyFilterWord($event)"
          (print)="printTableAsPdf()"
          (toggle)="col.toggleColumn($event)"
        >
          <!-- acciones extra -->
          <app-icon-action
            [icon]="'uil-folder-download'"
            [tooltip]="'Descargar facturas'"
            (click)="downloadFilteredPdfs(false)"
          />
        </app-page-toolbar>

        <div class="pb-4" #printArea>
          <h2 class="only-on-pdf print-title">Listado contabilidad</h2>
          <app-table
            [data]="list.processedSig()"
            [typeSection]="typeSection"
            [typeModal]="typeModal"
            [headerColumns]="col.getVisibleColumns()"
            [columnVisibility]="col.columnVisSig()"
            [displayedColumns]="col.displayedColumnsSig()"
            (openModal)="onOpenModal($event)"
            [topHeader]="60"
            [printExcludeColumns]="['invoice_pdf', 'proof_pdf']"
          />
        </div>
      </div>
    </mat-tab>

    <mat-tab label="Facturas">
      <div class="flex flex-col gap-y-8 py-8">
        <app-page-toolbar
          [addText]="'Añadir movimiento'"
          [columns]="headerListInvoices"
          [visibility]="col.columnVisSig"
          (add)="addNewInvoiceModal()"
          (search)="applyFilterWord($event)"
          (print)="printTableAsPdf()"
          (toggle)="col.toggleColumn($event)"
        >
          <app-icon-action
            [icon]="'uil-folder-download'"
            [tooltip]="'Descargar facturas'"
            (click)="downloadFilteredPdfs(false)"
          />
        </app-page-toolbar>

        <div class="pb-4" #printArea>
          <h2 class="only-on-pdf print-title">Listado contabilidad</h2>
          <app-table
            [data]="list.processedSig()"
            [typeSection]="typeSection"
            [typeModal]="typeModal"
            [headerColumns]="col.getVisibleColumns()"
            [columnVisibility]="col.columnVisSig()"
            [displayedColumns]="col.displayedColumnsSig()"
            (openModal)="onOpenModal($event)"
            [topHeader]="60"
            [printExcludeColumns]="['invoice_pdf', 'proof_pdf']"
          />
        </div>
      </div>
    </mat-tab>

    <mat-tab label="Tickets">
      <div class="flex flex-col gap-y-8 py-8">
        <app-page-toolbar
          [addText]="'Añadir movimiento'"
          [columns]="headerListInvoices"
          [visibility]="col.columnVisSig"
          (add)="addNewInvoiceModal()"
          (search)="applyFilterWord($event)"
          (print)="printTableAsPdf()"
        >
          <app-icon-action
            [icon]="'uil-folder-download'"
            [tooltip]="'Descargar tickets'"
            (click)="downloadFilteredPdfs(false)"
          />
        </app-page-toolbar>

        <div class="pb-4" #printArea>
          <h2 class="only-on-pdf print-title">Listado contabilidad</h2>
          <app-table
            [data]="list.processedSig()"
            [typeSection]="typeSection"
            [typeModal]="typeModal"
            [headerColumns]="col.getVisibleColumns()"
            [columnVisibility]="col.columnVisSig()"
            [displayedColumns]="col.displayedColumnsSig()"
            (openModal)="onOpenModal($event)"
            [topHeader]="60"
            [printExcludeColumns]="['invoice_pdf', 'proof_pdf']"
          />
        </div>
      </div>
    </mat-tab>

    <mat-tab label="Ingresos">
      <div class="flex flex-col gap-y-8 py-8">
        <app-page-toolbar
          [addText]="'Añadir movimiento'"
          [columns]="headerListInvoices"
          [visibility]="col.columnVisSig"
          (add)="addNewInvoiceModal()"
          (search)="applyFilterWord($event)"
          (print)="printTableAsPdf()"
          (toggle)="col.toggleColumn($event)"
        >
          <app-icon-action
            [icon]="'uil-folder-download'"
            [tooltip]="'Descargar ingresos'"
            (click)="downloadFilteredPdfs(false)"
          />
        </app-page-toolbar>

        <div class="pb-4" #printArea>
          <h2 class="only-on-pdf print-title">Listado contabilidad</h2>
          <app-table
            [data]="list.processedSig()"
            [typeSection]="typeSection"
            [typeModal]="typeModal"
            [headerColumns]="col.getVisibleColumns()"
            [columnVisibility]="col.columnVisSig()"
            [displayedColumns]="col.displayedColumnsSig()"
            (openModal)="onOpenModal($event)"
            [topHeader]="60"
            [printExcludeColumns]="['invoice_pdf', 'proof_pdf']"
          />
        </div>
      </div>
    </mat-tab>
  </mat-tab-group>
  } @else {
  <div class="flex flex-col items-center justify-center py-16">
    <p class="text-lg text-gray-500 text-center">
      No hay contabilidad registrada de ese año.
    </p>
  </div>
  } }
</div>

<!-- Modal -->
<app-modal-shell
  [visible]="modalVisibleSig()"
  [typeModal]="typeModal"
  [action]="currentModalAction"
  [item]="item"
  (close)="onCloseModal()"
  (confirmDelete)="onDelete($event)"
  (sendFormInvoiceData)="sendFormInvoice($event)"
/>
