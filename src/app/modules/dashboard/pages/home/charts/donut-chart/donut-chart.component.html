<div class="donut-layout" role="group" [attr.aria-label]="title">
  <!-- Leyenda izquierda (ancho fijo por input) -->
  <ul class="donut-legend left" [style.width.px]="legendWidth">
    @if (isEmpty()) {
    <li class="muted">
      <span class="dot" [style.background]="emptyColor"></span>
      <span class="name">Sin datos</span>
      <span class="val">0</span>
      <span class="pct">0%</span>
    </li>
    } @else { @for (d of data; track d.label) {
    <li>
      <span
        class="dot"
        [style.background]="colors[$index % colors.length]"
      ></span>
      <span class="name">
        {{
          d.label
            | dictTranslate
              : labelType!
              : {
                  fallback: d.label,
                  normalize:
                    labelType === dictType.PartnersAgeBuckets ? false : "upper"
                }
        }}
      </span>
      <span class="val">{{ d.value }}</span>
      <span class="pct">{{ pct(d.value) }}%</span>
    </li>
    } }
  </ul>

  <!-- Gráfico a la derecha con tamaño fijo (px) -->
  <svg
    class="donut-svg"
    [style.width.px]="size"
    [style.height.px]="size"
    [attr.viewBox]="'0 0 ' + size + ' ' + size"
    preserveAspectRatio="xMidYMid meet"
    role="img"
    [attr.aria-label]="title"
  >
    <!-- Fondo: anillo gris SIEMPRE visible -->
    <circle
      [attr.cx]="cx"
      [attr.cy]="cy"
      [attr.r]="rEmpty"
      fill="none"
      [attr.stroke]="emptyColor"
      [attr.stroke-opacity]="emptyOpacity"
      [attr.stroke-width]="emptyStrokeWidth"
    />

    <!-- Sectores solo si hay datos -->
    @if (!isEmpty()) { @for (a of arcs(); track a.i) {
    <path
      [attr.d]="arcPath(cx, cy, rOuter, rInner, a.start, a.end)"
      [attr.fill]="a.color"
      [attr.stroke]="a.color"
      [attr.opacity]="0.9"
    />
    } }

    <!-- Centro -->
    <text
      [attr.x]="cx"
      [attr.y]="cy - 2"
      text-anchor="middle"
      class="donut-total"
    >
      {{ total() }}
    </text>
    <text
      [attr.x]="cx"
      [attr.y]="cy + 14"
      text-anchor="middle"
      class="donut-caption"
    >
      total
    </text>
  </svg>
</div>
