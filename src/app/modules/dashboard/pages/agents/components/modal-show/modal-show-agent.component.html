<div>
  <div class="flex flex-col-reverse gap-y-8 lg:flex-row lg:gap-x-24 lg:gap-y-0">
    <div class="flex-1">
      <img
        appImgBroken
        loading="lazy"
        [src]="(item.img ? item.img : '') | itemImage : typeModal"
        [alt]="item.name"
        class="imagen"
        (click)="openZoom()"
      />
    </div>

    <div class="flex flex-1 flex-col justify-between">
      <div
        class="inline-block border-b border-[#1C1C3A] pb-4 mb-4 md:pb-4 md:mb-8"
      >
        <app-text-title [text]="item.name" [align]="'left'"></app-text-title>
      </div>

      <div class="mb-4">
        <app-text-background [text]="item.category!"></app-text-background>
      </div>

      <div>
        <app-text-icon
          [icon]="'building'"
          [text]="item.address + ', ' + item.town + ' - ' + item.post_code"
        ></app-text-icon>
        <app-text-icon
          [icon]="'phone'"
          [text]="item.phone | phoneFormat"
        ></app-text-icon>
        <app-text-icon [icon]="'email'" [text]="item.email"></app-text-icon>
      </div>

      <hr class="my-4" />

      @if (item.observations) {
      <div class="flex flex-col gap-y-2 ml-4 pt-3">
        <app-text-editor [text]="item.observations"></app-text-editor>
      </div>
      }
    </div>
  </div>

  <hr class="mt-6 mb-6 border-b-1 border-[#1C1C3A]" />

  <p class="text-[18px] font-normal mb-6">Eventos</p>

  <div class="w-full">
    @if (eventsFacade.isLoadingItem$ | async) {
    <p class="text-sm text-gray-500 mt-2">Cargando eventos‚Ä¶</p>
    } @else if (eventsOfAgent.length > 0) {

    <!-- üîπ Iterar por a√±o (descendente) -->
    @for (year of (eventsByYear | keyvalue : keyDesc); track trackYear($index,
    year)) {
    <div class="mb-10 mx-20">
      <p class="text-[14px] font-semibold">{{ year.key }}</p>

      <div class="flex flex-col gap-y-2">
        @for (event of year.value; track trackEvent($index, event)) {
        <app-card-events-mini
          [event]="event"
          [isDashboard]="true"
          [showButtonsActions]="false"
          (openEvent)="onOpenEvent($event)"
        />
        }
      </div>
    </div>
    }

    <!-- üîπ Resumen final -->
    <div class="mb-4">
      <p class="text-[14px] font-semibold">Eventos totales por a√±o</p>
    </div>
    <app-table-total-years [rows]="eventsRows" [totalCount]="totalEvents">
    </app-table-total-years>

    } @else {
    <!-- üîπ Mensaje si no hay eventos -->
    <div class="mt-6">
      <app-text-background [text]="'Eventos'"></app-text-background>
      <p class="text-left text-gray-600 mt-4">
        No hay eventos registrados de este agente.
      </p>
    </div>
    }
  </div>
</div>
@if (showZoom) {
<app-image-zoom-overlay
  [open]="showZoom"
  [src]="(item.img ? item.img : '') | itemImage : typeModal"
  [alt]="item.name"
  [maxScale]="5"
  [minScale]="1"
  [caption]="item.name"
  (closed)="closeZoom()"
></app-image-zoom-overlay>
}
