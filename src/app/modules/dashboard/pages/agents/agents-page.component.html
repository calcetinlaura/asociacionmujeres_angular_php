<app-sticky-zone>
  <app-dashboard-header
    [icon]="'uil-comments'"
    [title]="'Entidades colaboradoras'"
    [number]="number"
    [type]="'agentes'"
  />
  <div class="flex flex-col gap-y-10">
    <app-filters
      [filters]="filters"
      (filterClicked)="filterSelected($event)"
    ></app-filters>
    <div class="flex gap-x-4 items-center">
      <app-button-icon
        [buttonText]="'Nuevo agente'"
        [iconClass]="'uil-plus'"
        (addClicked)="addNewAgentModal()"
      />
      <app-input-search (onDebounce)="applyFilterWord($event)" class="flex-1" />

      <app-icon-action
        [icon]="'uil-print'"
        [tooltip]="'Imprimir tabla'"
        (click)="printTableAsPdf()"
      ></app-icon-action>
      <app-column-menu
        [columns]="headerListAgents"
        [visibility]="columnVisibility"
        (toggle)="toggleColumn($event)"
      />
    </div>
  </div>
</app-sticky-zone>
<div class="flex flex-col px-8">
  @if (agentsFacade.isLoading$ | async) {
  <app-spinner-loading />
  } @else { @if(filteredAgents.length > 0){
  <div class="pb-4" #printArea>
    <h2 class="only-on-pdf print-title">Listado agentes</h2>
    <app-table
      [data]="filteredAgents"
      [typeSection]="typeSection"
      [typeModal]="typeModal"
      [headerColumns]="getVisibleColumns()"
      [columnVisibility]="columnVisibility"
      (openModal)="onOpenModal($event)"
      [displayedColumns]="displayedColumns"
    />
  </div>
  }@else{
  <div class="text-center text-gray-600 my-12 text-lg">
    No hay agentes registrados.
  </div>
  } }
</div>

<!-- Modal -->

<!-- Modal de AGENTES -->
@if (isModalVisible && typeModal === typeList.Agents) {
<app-modal
  [item]="item"
  [typeModal]="typeModal"
  [action]="currentModalAction"
  (closeModal)="onCloseModal()"
  (confirmDelete)="onDelete($event)"
  (sendFormAgentData)="sendFormAgent($event)"
  (openEvent)="onOpenEvent($event)"
/>
}

<!-- Modal de EVENTOS -->
@if (isModalVisible && typeModal === typeList.Events) {
<app-modal
  [item]="item"
  [typeModal]="typeModal"
  [action]="currentModalAction"
  (closeModal)="onCloseModal()"
  (confirmDelete)="onDelete($event)"
  (sendFormAgentData)="sendFormAgent($event)"
  (openEvent)="onOpenEvent($event)"
  [canGoBack]="modalHistory.length > 0"
  (back)="onBackModal()"
/>
}
