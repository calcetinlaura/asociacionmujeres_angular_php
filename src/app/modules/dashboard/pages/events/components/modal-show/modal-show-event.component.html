<!-- SPINNER OVERLAY ACCESIBLE -->
@if (loading) {
<div
  class="fixed inset-0 z-[60] bg-white/70 backdrop-blur-sm flex items-center justify-center"
>
  <div
    class="h-10 w-10 rounded-full border-4 border-gray-300 border-t-transparent animate-spin"
    role="status"
    aria-live="polite"
    aria-label="Cargando evento"
  ></div>
</div>
}
<div>
  <div class="flex w-full items-center justify-end mb-1">
    <app-event-publish-pill
      [event]="item"
      [locale]="appLocale"
    ></app-event-publish-pill>
  </div>
  <div class="text-center">
    <div
      class="inline-block border-b border-[#1C1C3A] pb-4 mb-4 md:pb-4 md:mb-8"
    >
      <app-text-title [text]="item.title" />
      @if (item.placeData?.name) {
      <app-text-subtitle [text]="item.placeData?.name + ' | ' + item.town" />
      } @if (item.macroeventData && item.macroeventData.title) {
      <p
        class="macro cursor-pointer my-2"
        (click)="onOpenMacroevent(item.macroeventData.id)"
      >
        {{ item.macroeventData.title }}
      </p>
      } @if(!isDashboard){
      <app-social-media-share [url]="shareUrl" [title]="shareTitle" />}
    </div>
  </div>
  <div class="flex flex-col-reverse gap-y-8 lg:flex-row lg:gap-x-10 lg:gap-y-0">
    <div class="lg:w-2/5">
      <img
        appImgBroken
        loading="lazy"
        [src]="(item.img ? item.img : '') | itemImage : typeModal"
        [alt]="item.title"
        class="w-full"
        (click)="openZoom()"
      />
    </div>
    <div class="lg:w-3/5 flex flex-col justify-between gap-y-4">
      @if (item.category){
      <div class="flex gap-x-2 flex-wrap">
        @for (category of (item.category || []); track category) {
        <app-text-background
          [text]="category | dictTranslate : dictType.Categories"
          colorBack="#C1E6DD"
        ></app-text-background>
        }
      </div>
      } @if (item.description){
      <app-text-editor [text]="item.description"></app-text-editor>
      } @if (item.periodicEvents === null){
      <div class="flex flex-row gap-x-4">
        <ng-container class="lowercase">
          @if (item.start && item.end === item.start) {
          <p
            class="text-[9px] md:text-[12px] px-[6px] pt-1 pb-[3px] rounded-[4px] border-[1px] border-lilaOscuro"
          >
            {{ item.start | date : "EEEE dd MMMM yyyy" }}
          </p>
          }
        </ng-container>
        @if (item.start && item.end !== item.start) {
        <div class="flex items-center gap-x-2 flex-wrap">
          <span
            class="text-[9px] md:text-[12px] px-[6px] pt-1 pb-[3px] rounded-[4px] border-[1px] border-lilaOscuro"
            >{{ item.start | date : "EEEE dd MMMM" }}</span
          >
          al
          <span
            class="text-[9px] md:text-[12px] px-[6px] pt-1 pb-[3px] rounded-[4px] border-[1px] border-lilaOscuro"
            >{{ item.end | date : "EEEE dd MMMM yyyy" }}</span
          >
        </div>
        }@if ( item.time_start && item.time_start !== '00:00:00') {
        <div class="flex justify-start">
          <p
            class="text-[9px] md:text-[12px] px-[6px] pt-1 pb-[3px] rounded-[4px] border-[1px] border-lilaClaro"
          >
            {{ item.time_start.slice(0, 5) + " h" }}
          </p>
        </div>
        }
      </div>
      } @if (item.periodicEvents && item.periodicEvents.length > 0) {
      <p
        class="text-[16px] leading-[16px] uppercase text-lilaOscuro font-semibold"
      >
        Pases
      </p>
      <div class="pl-6 flex flex-col gap-y-4">
        @for (func of item.periodicEvents; track (func?.id ?? (func.start + '-'
        + (func.time_start ?? '') + '-' + $index))) {
        <div class="flex sm:flex-row gap-x-4 items-center">
          <p
            class="text-[9px] md:text-[12px] px-[6px] pt-1 pb-[3px] rounded-[4px] border-[1px] border-lilaOscuro"
          >
            {{ func.start | date : "EEEE dd MMMM yyyy" }}
          </p>

          @if (func.time_start !== '00:00:00') {
          <p
            class="text-[9px] md:text-[12px] px-[6px] pt-1 pb-[3px] rounded-[4px] border-[1px] border-lilaClaro"
          >
            {{ func.time_start.slice(0, 5) + " h" }}
          </p>
          }
        </div>
        }
      </div>
      }@if(item.access === 'FREE'){
      <app-text-background [text]="'Acceso gratuito'"></app-text-background>}
      @if (item.access === 'TICKETS'){
      <p
        class="text-[16px] leading-[16px] uppercase text-lilaOscuro font-semibold"
      >
        Precio
      </p>
      <div class="pl-6 flex flex-col gap-y-4">
        @for (ticket of item.ticket_prices; track (ticket.type + '-' +
        ticket.price + '-' + $index)){
        <div class="flex sm:flex-row gap-x-4 items-center">
          <p
            class="text-[9px] md:text-[12px] px-[6px] pt-1 pb-[3px] rounded-[4px] border-[1px] border-lilaClaro"
          >
            {{ ticket.type }}
          </p>

          @if (ticket.price!.toString() !== "0") {
          <p
            class="text-[9px] md:text-[12px] px-[6px] pt-1 pb-[3px] rounded-[4px] border-[1px] border-lilaClaro"
          >
            {{ ticket.price + " €" }}
          </p>
          }@if (ticket.price!.toString() === "0") {
          <p
            class="text-[9px] md:text-[12px] px-[6px] pt-1 pb-[3px] rounded-[4px] border-[1px] border-lilaClaro"
          >
            Gratis
          </p>
          }
        </div>
        }
      </div>

      }@if (item.audience) {
      <div class="flex">
        <div
          class="border-r-[1px] border-lilaOscuro w-[80px] md:w-[120px] text-[10px] flex justify-start items-center mr-4"
        >
          Público recomendado
        </div>
        @for (badge of (item.audience | audienceBadges); track (badge + '-' +
        $index)) {
        <app-text-background
          [text]="badge"
          colorBack="#bed8f7"
        ></app-text-background>
        }
      </div>

      } @if (item.open_doors) {
      <div class="flex">
        <div
          class="border-r-[1px] border-lilaOscuro w-[80px] md:w-[120px] text-[10px] flex justify-start items-center mr-4"
        >
          Apertura de puertas
        </div>

        <app-text-background
          [text]="item.open_doors.slice(0, 5) + 'h'"
          colorBack="#bed8f7"
        ></app-text-background>
      </div>

      } @if (item.parking) {
      <div class="flex">
        <div
          class="border-r-[1px] border-lilaOscuro w-[80px] md:w-[120px] text-[10px] flex justify-start items-center mr-4"
        >
          Aparcamiento
        </div>
        <div class="flex-1">
          <app-text-background
            [text]="item.parking | dictTranslate : dictType.Parking"
            colorBack="#bed8f7"
          ></app-text-background>
          <p class="pt-4 text-[11px]">{{ item.parking_info }}</p>
        </div>
      </div>
      } @if ( (item.faqs | ensureArray).length > 0 ) {
      <div class="flex">
        <div
          class="border-r-[1px] border-lilaOscuro w-[80px] md:w-[120px] text-[10px] flex justify-start items-center mr-4"
        >
          Preguntas frecuentes
        </div>
        <div class="flex-1">
          @for (faq of (item.faqs | ensureArray); track faq) {
          <div class="pt-2">
            <p class="font-semibold text-[11px]">{{ faq.q }}</p>
            <p class="pt-2 text-[11px]">{{ faq.a }}</p>
          </div>
          }
        </div>
      </div>
      } @if ( (item.websites | ensureArray).length > 0 ) {
      <div class="flex">
        <div
          class="border-r-[1px] border-lilaOscuro w-[80px] md:w-[120px] text-[10px] flex justify-start items-center mr-4"
        >
          Página web
        </div>
        <div class="flex-1">
          @for (site of (item.websites | ensureArray); track site) {
          <a href="site.url" target="_blank">{{ site.title }} </a>
          }
        </div>
      </div>
      } @if ((item.socials | ensureArray).length > 0) {
      <div class="flex">
        <div
          class="border-r-[1px] border-lilaOscuro w-[80px] md:w-[120px] text-[10px] flex justify-start items-center mr-4"
        >
          Redes sociales
        </div>

        <div class="flex-1 flex flex-wrap gap-2 items-center">
          @for (soc of (item.socials | ensureArray); track soc) {
          <a
            [attr.href]="soc | socialUrl"
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center gap-2"
          >
            <i class="text-[18px]" [ngClass]="soc?.network | socialIcon"></i>
            <span class="text-[12px] capitalize">{{ soc.network }}</span>
          </a>
          }
        </div>
      </div>
      } @if (item.organizer && item.organizer.length > 0) {
      <div class="flex">
        <div
          class="border-r-[1px] border-lilaOscuro w-[80px] md:w-[120px] text-[10px] flex justify-start items-center"
        >
          Organiza
        </div>
        <div class="flex-1 flex flex-col justify-center">
          @for (organizer of item.organizer; track (organizer?.id ??
          (organizer.name + '-' + $index))) {
          <p class="text-[10px] pl-3">{{ organizer.name }}</p>
          }
        </div>
      </div>
      } @if (item.collaborator && item.collaborator.length > 0) {
      <div class="flex">
        <div
          class="border-r-[1px] border-lilaOscuro w-[80px] md:w-[120px] text-[10px] flex justify-start items-center"
        >
          Colabora
        </div>

        <div class="flex-1 flex flex-col justify-center">
          @for (colab of item.collaborator; track (colab?.id ?? (colab.name +
          '-' + $index))) {
          <p class="text-[10px] pl-3">{{ colab.name }}</p>
          }
        </div>
      </div>
      } @if (item.sponsor && item.sponsor.length > 0) {
      <div class="flex">
        <div
          class="border-r-[1px] border-lilaOscuro w-[80px] md:w-[120px] text-[10px] flex justify-start items-center"
        >
          Patrocina
        </div>

        <div class="flex-1 flex flex-col justify-center">
          @for (sponsor of item.sponsor; track (sponsor?.id ?? (sponsor.name +
          '-' + $index))) {
          <p class="text-[10px] pl-3">{{ sponsor.name }}</p>
          }
        </div>
      </div>
      } @if (item.inscription_method ) {
      <div class="flex">
        <div
          class="border-r-[1px] border-lilaOscuro w-[80px] md:w-[120px] text-[10px] flex justify-start items-center"
        >
          Inscripción
        </div>
        <div class="flex-1">
          <p
            class="text-[11px] pl-3"
            [innerHTML]="item.inscription_method | safeHtml"
          ></p>
        </div>
      </div>
      }@if (item.tickets_method) {
      <div class="flex">
        <div
          class="border-r-[1px] border-lilaOscuro w-[80px] md:w-[120px] text-[10px] flex justify-start items-center"
        >
          Reservas
        </div>
        <div class="flex-1">
          <p
            class="pl-3 text-[11px]"
            [innerHTML]="item.tickets_method | safeHtml"
          ></p>
        </div>
      </div>
      } @if (item.status === enumStatusEnum.CANCELADO) {
      <app-text-background
        [text]="'Evento ' + item.status"
        [colorBack]="'#de7a71'"
      ></app-text-background>
      } @if (item.status === enumStatusEnum.AGOTADO) {
      <div class="flex justify-center my-4">
        <app-text-background
          [text]="'Plazas agotadas'"
          [colorBack]="'#de7a71'"
          [colorText]="'white'"
          [number]="12"
        ></app-text-background>
      </div>
      } @if (item.status_reason) {
      <app-text-editor [text]="item.status_reason"></app-text-editor>
      } @if ((item.videos | ensureArray).length > 0) {
      <div class="space-y-4">
        @for (vid of (item.videos | ensureArray); track vid) {
        <!-- Opción con plugin aspect-ratio -->
        <div class="aspect-video">
          <iframe
            class="w-full h-full rounded-lg"
            [src]="vid.url | youtubeEmbed"
            title="{{ vid.title || 'Vídeo' }}"
            frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
            allowfullscreen
          ></iframe>
        </div>

        @if (vid.title) {
        <p class="mt-2 text-sm text-gray-700">{{ vid.title }}</p>
        } }
      </div>
      }
      <hr class="mt-2 mb-2 border-b-1 border-[#1C1C3A]" />
      <div class="flex items-center gap-x-6">
        <div>
          <span
            class="inline-block w-7 h-7 shrink-0 text-red-500"
            [style.maskImage]="'url(assets/icons/building.svg)'"
            [style.webkitMaskImage]="'url(assets/icons/building.svg)'"
            style="
              mask-size: contain;
              mask-repeat: no-repeat;
              mask-position: center;
              -webkit-mask-size: contain;
              -webkit-mask-repeat: no-repeat;
              -webkit-mask-position: center;
              background-color: currentColor;
            "
          >
          </span>
        </div>

        <div class="flex flex-col border-l-[1px] border-lilaOscuro pl-4">
          <p>{{ item.placeData?.name }}</p>
          <p>
            {{ item.placeData?.address }} @if(item.placeData?.address){, }
            {{ item.town }}
          </p>
          @if (item.salaData?.name) {
          <p class="text-gray-500 pb-2">
            {{ item.salaData?.name }}
            {{
              item.salaData?.room_location
                ? ", " +
                  (item.salaData?.room_location
                    | filterTransformCode : "roomLocationPlaces")
                : ""
            }}
          </p>
          }
        </div>
      </div>
      @if (item.placeData && item.placeData.lat && item.placeData.lon) {
      <app-map [lat]="item.placeData.lat" [lon]="item.placeData.lon"></app-map>
      }
    </div>
  </div>
</div>
@if (showZoom) {
<app-image-zoom-overlay
  [open]="showZoom"
  [src]="(item.img ? item.img : '') | itemImage : typeModal"
  [alt]="item.title!"
  [maxScale]="5"
  [minScale]="1"
  [caption]="item.title"
  (closed)="closeZoom()"
></app-image-zoom-overlay>
}
