<div class="flex flex-1 flex-col justify-between" #pdfArea>
  <div class="inline-block border-b border-[#1C1C3A] pb-4 mb-4 md:pb-4 md:mb-8">
    <app-text-title [text]="item.title + ' ' + item.year" />
  </div>
  <div class="flex justify-center mb-4">
    <app-text-background [text]="'SUBVENCIÓN - ' + item.subsidy_name!" />
    <app-icon-action
      [icon]="'uil-print'"
      [tooltip]="'Imprimir PDF'"
      (click)="printTableAsPdf()"
      data-html2canvas-ignore="true"
    ></app-icon-action>
  </div>

  <div class="flex flex-row gap-x-4 justify-center">
    <div class="box-amount w-auto box-invoices">
      <p>EVENTOS</p>
      <p class="text-center">{{ item.events?.length }}</p>
    </div>
    <div class="box-amount w-auto box-invoices">
      <p>TAREAS</p>
      <p class="text-center">{{ item.activities?.length }}</p>
    </div>
    <div class="box-amount w-auto">
      <p>PRESUPUESTO INICIAL</p>
      <p class="text-center">
        {{ getProjectTotalBudget(item) | eurosFormat }}
      </p>
    </div>

    <div class="box-amount w-auto">
      <p>FACTURACIÓN FINAL</p>
      <p class="text-center">
        {{ getProjectInvoicesTotalBudget(item) | eurosFormat }}
      </p>
    </div>
  </div>

  @if (item.description) {
  <app-text-editor [text]="item.description" />
  } @if (item.events && item.events.length > 0) {
  <p class="text-[18px] font-normal mt-6 mb-4">Eventos</p>
  <div class="mx-8 flex flex-col gap-y-2">
    @for (event of item.events; track event; let pIndex = $index) {
    <app-card-events-mini
      [event]="event"
      [isDashboard]="true"
      [showButtonsActions]="false"
      (openEvent)="onOpenEvent($event)"
    />

    }
  </div>
  } @if (item.activities && item.activities.length > 0) {
  <p class="text-[18px] font-normal mt-8 mb-4">Presupuesto - tareas</p>
  <div class="w-full">
    <table class="w-full -collapse tableProjects my-4">
      @for (activity of item.activities; track activity; let pIndex = $index) {

      <tbody>
        <tr class="hover:bg-gray-50 cursor-pointer">
          <td class="p-2 w-auto">
            {{ activity.name }}
          </td>

          <td class="p-2 w-1/2">
            <div>
              <p class="text-[13px] text-gray-800">
                <span [innerHTML]="activity.observations | safeHtml"></span>
              </p>
              @if (activity.attendant) {
              <p class="text-[12px] text-gray-500 flex items-center gap-1 mt-1">
                <i class="uil uil-user text-[10px]"></i>
                {{ activity.attendant }}
              </p>
              }
            </div>
          </td>

          <td class="p-2 w-auto text-right">
            {{ activity.budget | eurosFormat }}
          </td>
        </tr>
      </tbody>

      }
      <tfoot>
        <tr class="total_table">
          <!-- Etiqueta total ocupando las 3 primeras columnas -->
          <td colspan="2" class="text-right text-[12px] font-semibold pr-4">
            TOTAL
          </td>
          <!-- Total de todos los proyectos -->
          <td class="text-right text-[12px] font-bold">
            {{ getProjectTotalBudget(item) | eurosFormat }}
          </td>
        </tr>
      </tfoot>
    </table>
  </div>
  } @if (item.invoices && item.invoices.length > 0) {
  <!-- GASTOS -->
  @if (getProjectExpenses(item).length > 0) {
  <p class="text-[18px] font-normal mt-8 mb-4">Gastos</p>
  <div class="w-full">
    <app-invoices-table
      [invoices]="getProjectExpenses(item)"
      [showCreditor]="true"
      [showTotals]="true"
      totalLabel="TOTAL GASTOS"
      (rowClick)="onOpenInvoice($event)"
    />
  </div>
  }

  <!-- INGRESOS -->
  @if (getProjectIncomes(item).length > 0) {
  <p class="text-[18px] font-normal mt-4 mb-4">Ingresos</p>
  <div class="w-full">
    <app-invoices-table
      [invoices]="getProjectIncomes(item)"
      [showCreditor]="true"
      [showTotals]="true"
      totalLabel="TOTAL INGRESOS"
      (rowClick)="onOpenInvoice($event)"
    />
  </div>

  <p class="text-[18px] font-normal mt-4 mb-4">Balanza</p>
  <div class="w-full">
    <table class="w-full -collapse tableProjects my-4">
      <tbody>
        <tr>
          <td class="p-2 text-right">Total gastos</td>
          <td class="p-2 text-right">{{ totalExpenses | eurosFormat }}</td>
        </tr>
        <tr>
          <td class="p-2 text-right">Total ingresos</td>
          <td class="p-2 text-right">{{ totalIncomes | eurosFormat }}</td>
        </tr>
        <tr class="total_table">
          <td class="p-2 text-right font-bold">Balance</td>
          <td
            class="p-2 text-right font-bold"
            [ngClass]="{
              'text-green-700': balance > 0,
              'text-red-700': balance < 0
            }"
          >
            {{ balance | eurosFormat }}
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  } }
</div>
