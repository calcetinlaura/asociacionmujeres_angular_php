<!-- Navegación del mes -->
<div class="max-w-4xl mx-auto p-4">
  <div class="flex items-center justify-between mb-4">
    <button (click)="prevMonth()" class="text-2xl px-2">‹</button>
    <h2 class="text-2xl font-bold text-center capitalize">
      {{ currentMonthLabel }}
    </h2>
    <button (click)="nextMonth()" class="text-2xl px-2">›</button>
  </div>

  <!-- Días de la semana -->
  <div class="grid grid-cols-7 text-center text-gray-500 mb-2 font-semibold">
    <div>LU</div>
    <div>MA</div>
    <div>MI</div>
    <div>JU</div>
    <div>VI</div>
    <div>SA</div>
    <div>DO</div>
  </div>

  <!-- Días del calendario -->
  <div class="grid grid-cols-7 gap-2">
    @for (cell of calendar; track $index) {
    <div
      class="aspect-square bg-gray-100 relative overflow-hidden rounded-md"
      [ngClass]="{ 'ring-2 ring-blue-500': isToday(cell.date) }"
    >
      @if (cell.date) {
      <!-- Número del día -->
      <div
        class="absolute top-1 right-1 text-xs text-white bg-black bg-opacity-50 rounded px-1 z-10"
      >
        {{ cell.date.getDate() }}
      </div>

      <!-- FLEX WRAP para eventos -->
      <div class="w-full h-full flex flex-wrap">
        @for (event of cell.events; track $index) {
        <div
          class="relative"
          [ngStyle]="{
            width: getFlexBasis(cell.events.length),
            height: getFlexBasis(cell.events.length)
          }"
        >
          <div
            class="aspect-square bg-gray-100 relative overflow-hidden rounded-md cursor-pointer"
            [ngClass]="{ 'ring-2 ring-blue-500': isToday(cell.date) }"
            (click)="handleCellClick(cell)"
          >
            <img
              appImgBroken
              [src]="(event.img ? event.img : '') | itemImage : typeModal"
              alt="{{ event.title }}"
              class="object-cover w-full h-full cursor-pointer"
            />
          </div>
        </div>
        }
      </div>

      <!-- Badge con +N -->
      @if (cell.events.length > 1) {
      <div
        class="cursor-pointer absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-sm font-bold text-black bg-[#c79cd3] bg-opacity-80 rounded p-4 z-20"
        (click)="openMultiEventModal($event, cell.events)"
      >
        +{{ cell.events.length }}
      </div>
      } }
    </div>
    }
  </div>
</div>

<!-- Modales -->
@if (showModalView) {
<app-modal
  [item]="item"
  [typeModal]="typeModal"
  [action]="selectedActionModal"
  (closeModal)="onCloseModal()"
/>
} @if (showMultiEventModal) {
<app-modal-multievent
  [(open)]="showMultiEventModal"
  [events]="multiEventItems"
  [closeOnSelect]="false"
  (select)="selectEventFromMulti($event)"
/>
}
