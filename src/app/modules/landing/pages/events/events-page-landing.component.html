<div class="flex flex-col mx-3 md:mx-8 mt-4">
  <!-- ðŸ”¹ Filtros de aÃ±o -->
  <app-filters
    [filters]="filters"
    [(selected)]="selectedFilter"
    (filterClicked)="filterSelected($event)"
  ></app-filters>

  <!-- ðŸ”¹ Variables locales -->
  @let loading = (eventsFacade.isListLoading$ | async) ?? false; @let yearEvents
  = calendarList.sortedSig(); @let upcoming = upcomingListSig(); @let past =
  pastListSig();

  <!-- ðŸ”¹ Cargando -->
  @if (loading) {
  <div class="mt-24">
    <app-spinner-loading />
  </div>
  } @else {
  <!-- ðŸ”¹ Calendario (solo si hay eventos del aÃ±o filtrado) -->
  @if (yearEvents.length > 0 && filterYearForCalendar !== null) {
  <app-calendar
    [events]="yearEvents"
    [filterYear]="filterYearForCalendar"
    [isDashboard]="isDashboard"
    [deepLinkMultiDate]="deepLinkMultiDate"
    (viewEvent)="onOpenEvent($event)"
    (openMulti)="onOpenMulti($event)"
  ></app-calendar>
  }

  <!-- ðŸ”¹ PrÃ³ximos eventos -->
  @if (upcoming.length > 0) {
  <app-section-generic
    [typeSection]="typeList.Events"
    [data]="upcoming"
    [total]="upcoming.length"
    (itemClicked)="onOpenEvent($event)"
  />
  }

  <!-- ðŸ”¹ Eventos pasados -->
  @if (past.length > 0) {
  <p class="mt-6 mb-2 font-semibold">Eventos pasados</p>
  <app-section-generic
    [typeSection]="typeList.Events"
    [data]="past"
    [total]="past.length"
  />
  } @else {
  <!-- ðŸ”¹ Si no hay prÃ³ximos ni pasados -->
  @if (upcoming.length === 0) {
  <app-no-results [text]="'eventos' | lowercase" />
  } } }
</div>

<!-- ðŸ”¹ Modal genÃ©rica (MultiEvent / Evento / MacroEvent) -->
@if (modalFacade.isVisibleSig()) {
<app-modal-shell
  [visible]="modalFacade.isOpenSig()"
  [isDashboard]="isDashboard"
  [typeModal]="modalFacade.typeSig()"
  [action]="modalFacade.actionSig()"
  [item]="modalFacade.itemSig()"
  [canGoBack]="modalFacade.canGoBack()"
  (back)="modalFacade.back()"
  (close)="modalFacade.close()"
  (openEvent)="onOpenEvent($event)"
  (openMacroevent)="onOpenMacroEvent($event)"
/>
}
